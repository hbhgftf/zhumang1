{"version":3,"file":"index-uniapp.js","sources":["pages-ai-desk/ai-desk-customer-uniapp/components/CustomerServiceChat/message-list/message-elements/message-quote/index-uniapp.vue","E:/HBuilderX/plugins/uniapp-cli-vite/uniComponent:/RDovSkFWQUVFL215ZmxpZXMvdW5pYXBwLWFwcC91bmlhcHAvcGFnZXMtYWktZGVzay9haS1kZXNrLWN1c3RvbWVyLXVuaWFwcC9jb21wb25lbnRzL0N1c3RvbWVyU2VydmljZUNoYXQvbWVzc2FnZS1saXN0L21lc3NhZ2UtZWxlbWVudHMvbWVzc2FnZS1xdW90ZS9pbmRleC11bmlhcHAudnVl"],"sourcesContent":["<template>\n  <div style=\"display:flex;width: fit-content;\">\n    <div v-if=\"hasQuoteContent\" :class=\"{\n      'mobile-left-box': true,\n      reverse: message.flow === 'out',\n        in:message.flow === 'in',\n    }\"></div>\n    <div\n      v-if=\"hasQuoteContent\"\n      :class=\"{\n        'reference-content': true,\n        reverse: message.flow === 'out',\n        in:message.flow === 'in',\n        'isMobile':true\n      }\"\n      @click=\"scrollToOriginalMessage\"\n    >\n      <div\n        v-if=\"isMessageRevoked\"\n        class=\"revoked-text\"\n      >\n        {{ TUITranslateService.t(\"TUIChat.引用内容已撤回\") }}\n      </div>\n        <div v-else>\n          <div  class=\"mobile-quote-sender\">\n              {{ messageQuoteContent.messageSender }}\n            </div>\n          <div\n            \n            class=\"max-double-line\"\n          >\n            {{ transformTextWithKeysToEmojiNames(messageQuoteText) }}\n          </div>\n        </div>\n    </div>\n  </div>\n  \n</template>\n\n<script lang=\"ts\" setup>\nimport vue from '../../../../../adapter-vue';\nimport {\n  TUIStore,\n  StoreName,\n  IMessageModel,\n  TUITranslateService,\n} from '@tencentcloud/chat-uikit-engine';\nimport {\n  getBoundingClientRect,\n  getScrollInfo,\n} from '@tencentcloud/universal-api';\nimport {\n  Toast,\n  TOAST_TYPE,\n} from '../../../../../components/common/Toast/index-uniapp';\nimport {\n  ICloudCustomData,\n  IQuoteContent,\n  MessageQuoteTypeEnum,\n} from './interface.ts';\nimport { transformTextWithKeysToEmojiNames } from '../../../emoji-config';\nconst { computed, ref, onMounted } = vue;\n\nexport interface IProps {\n  message: IMessageModel;\n}\n\nexport interface IEmits {\n  (e: 'scrollTo', scrollHeight: number): void;\n  (e: 'blinkMessage', messageID: string | undefined): void;\n}\n\nconst emits = defineEmits<IEmits>();\nconst props = withDefaults(defineProps<IProps>(), {\n  message: () => ({} as IMessageModel),\n});\n\nlet selfAddValue = 0;\nconst messageQuoteText = ref<string>('');\nconst hasQuoteContent = ref(false);\nconst messageQuoteContent = ref<IQuoteContent>({} as IQuoteContent);\n\nconst isMessageRevoked = computed<boolean>(() => {\n  try {\n    const cloudCustomData: ICloudCustomData = JSON.parse(\n      props.message?.cloudCustomData || '{}',\n    );\n    const quotedMessageModel = TUIStore.getMessageModel(\n      cloudCustomData.messageReply.messageID,\n    );\n    return quotedMessageModel?.isRevoked;\n  } catch (error) {\n    return true;\n  }\n});\n\nonMounted(() => {\n  try {\n    const cloudCustomData: ICloudCustomData = JSON.parse(\n      props.message?.cloudCustomData || '{}',\n    );\n    hasQuoteContent.value = Boolean(cloudCustomData.messageReply);\n    if (hasQuoteContent.value) {\n      messageQuoteContent.value = cloudCustomData.messageReply;\n      messageQuoteText.value = performQuoteContent(messageQuoteContent.value);\n    }\n  } catch (error) {\n    hasQuoteContent.value = false;\n  }\n});\n\nfunction performQuoteContent(params: IQuoteContent) {\n  let messageKey: string = '';\n  let quoteContent: string = '';\n  switch (params.messageType) {\n    case MessageQuoteTypeEnum.TYPE_TEXT:\n      messageKey = '[文本]';\n      break;\n    case MessageQuoteTypeEnum.TYPE_CUSTOM:\n      messageKey = '[自定义消息]';\n      break;\n    case MessageQuoteTypeEnum.TYPE_IMAGE:\n      messageKey = '[图片]';\n      break;\n    case MessageQuoteTypeEnum.TYPE_SOUND:\n      messageKey = '[音频]';\n      break;\n    case MessageQuoteTypeEnum.TYPE_VIDEO:\n      messageKey = '[视频]';\n      break;\n    case MessageQuoteTypeEnum.TYPE_FILE:\n      messageKey = '[文件]';\n      break;\n    case MessageQuoteTypeEnum.TYPE_LOCATION:\n      messageKey = '[地理位置]';\n      break;\n    case MessageQuoteTypeEnum.TYPE_FACE:\n      messageKey = '[动画表情]';\n      break;\n    case MessageQuoteTypeEnum.TYPE_GROUP_TIPS:\n      messageKey = '[群提示]';\n      break;\n    case MessageQuoteTypeEnum.TYPE_MERGER:\n      messageKey = '[聊天记录]';\n      break;\n    default:\n      messageKey = '[消息]';\n      break;\n  }\n  if (\n    [MessageQuoteTypeEnum.TYPE_TEXT, MessageQuoteTypeEnum.TYPE_MERGER].includes(\n      params.messageType,\n    )\n  ) {\n    quoteContent = params.messageAbstract;\n  }\n  return quoteContent\n    ? quoteContent\n    : TUITranslateService.t(`TUIChat.${messageKey}`);\n}\n\nasync function scrollToOriginalMessage() {\n  if (isMessageRevoked.value) {\n    return;\n  }\n  const originMessageID = messageQuoteContent.value?.messageID;\n  const currentMessageList = TUIStore.getData(StoreName.CHAT, 'messageList');\n  const isOriginalMessageInScreen = currentMessageList.some(\n    msg => msg.ID === originMessageID,\n  );\n  if (originMessageID && isOriginalMessageInScreen) {\n    try {\n      const scrollViewRect = await getBoundingClientRect(\n        '#messageScrollList',\n        'messageList',\n      );\n      const originalMessageRect = await getBoundingClientRect(\n        '#tui-' + originMessageID,\n        'messageList',\n      );\n      const { scrollTop } = await getScrollInfo(\n        '#messageScrollList',\n        'messageList',\n      );\n      const finalScrollTop\n        = originalMessageRect.top\n        + scrollTop\n        - scrollViewRect.top\n        - (selfAddValue++ % 2);\n      const isNeedScroll = originalMessageRect.top < scrollViewRect.top;\n      if (isNeedScroll) {\n        emits('scrollTo', finalScrollTop);\n      }\n      emits('blinkMessage', originMessageID);\n    } catch (error) {\n      uni.__f__('error','at pages-ai-desk/ai-desk-customer-uniapp/components/CustomerServiceChat/message-list/message-elements/message-quote/index-uniapp.vue:196',error);\n    }\n  } else {\n    Toast({\n      message: TUITranslateService.t('TUIChat.无法定位到原消息'),\n      type: TOAST_TYPE.WARNING,\n    });\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.reference-content {\n  max-width: 272px;\n  margin-top: 4px;\n\n  padding: 12px;\n  font-size: 12px;\n  color: #666;\n  word-wrap: break-word;\n  word-break: break-all;\n  background-color: #fbfbfb;\n  border-radius: 8px;\n  line-height: 16.8px;\n  cursor: pointer;\n  -webkit-tap-highlight-color: transparent;\n}\n\n.reverse.reference-content {\n  margin-right: 44px;\n  margin-left: auto;\n  border-radius: 0 8px 8px 0;\n}\n.isMobile.reference-content.in {\n  margin-right: auto;\n  background: #f3f4f7;\n  border-radius: 0 8px 8px 0;\n}\n.isMobile.reference-content.reverse {\n  margin-right: 10px;\n  margin-left: auto;\n  background: #FFFFFF1A;\n  color: white;\n}\n.mobile-left-box.reverse {\n  display:inline-block;\n    background: #FFFFFF33;\n    width: 5px;\n    margin-top: 4px;\n  border-radius: 8px 0 0 8px;\n  }\n.mobile-left-box.in {\n  display:inline-block;\n  background: #e1e2e5;    \n  width: 5px;\n    margin-top: 4px;\n  border-radius: 8px 0 0 8px;\n}\n.mobile-quote-sender{\n  font-family: PingFangSC-Regular;\n  font-size: 10px;\n\n}\n\n.revoked-text {\n  color: #999;\n}\n\n.max-double-line {\n  word-break: break-all;\n  overflow: hidden;\n  display: -webkit-box;\n  max-height: 33px;\n  -webkit-line-clamp: 2;\n  -webkit-box-orient: vertical;\n}\n</style>\n","import Component from 'D:/JAVAEE/myflies/uniapp-app/uniapp/pages-ai-desk/ai-desk-customer-uniapp/components/CustomerServiceChat/message-list/message-elements/message-quote/index-uniapp.vue'\nwx.createComponent(Component)"],"names":["vue","TUIStore","MessageQuoteTypeEnum","TUITranslateService","StoreName","getBoundingClientRect","getScrollInfo","uni","Toast","TOAST_TYPE"],"mappings":"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"}