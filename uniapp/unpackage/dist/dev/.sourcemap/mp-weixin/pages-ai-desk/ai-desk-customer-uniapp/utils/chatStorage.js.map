{"version":3,"file":"chatStorage.js","sources":["pages-ai-desk/ai-desk-customer-uniapp/utils/chatStorage.ts"],"sourcesContent":["import { isUniFrameWork } from './env';\nimport { TUIGlobal } from '@tencentcloud/universal-api';\n\ninterface IChatStorage {\n  getChatStorage(key: string): any;\n  setChatStorage(key: string, value: any): void;\n}\n\nclass ChatStorage implements IChatStorage {\n  private static instance: ChatStorage | null = null;\n  private static CHAT_STORAGE_KEY: string = 'TUI_CHAT_STORAGE';\n\n  private chatStorage: Record<string, any> | null = null;\n\n  private constructor() { }\n\n  public static getInstance(): ChatStorage {\n    if (!ChatStorage.instance) {\n      ChatStorage.instance = new ChatStorage();\n    }\n    return ChatStorage.instance;\n  }\n\n  public getChatStorage(key: string): any | undefined {\n    if (!this.chatStorage) {\n      this.chatStorage = this.getChatStorageFromLocalStorage();\n    }\n    if (key) {\n      return this.chatStorage[key];\n    } else {\n      throw new Error('No key provided');\n    }\n  }\n\n  public setChatStorage(key: string, value: any): void {\n    if (!this.chatStorage) {\n      this.chatStorage = this.getChatStorageFromLocalStorage();\n    }\n    this.chatStorage[key] = value;\n    try {\n      if (isUniFrameWork) {\n        TUIGlobal.setStorageSync(ChatStorage.CHAT_STORAGE_KEY, JSON.stringify(this.chatStorage));\n      } else {\n        localStorage.setItem(ChatStorage.CHAT_STORAGE_KEY, JSON.stringify(this.chatStorage));\n      }\n    } catch (error) {\n      throw new Error('Fail to set chat storage');\n    }\n  }\n\n  private getChatStorageFromLocalStorage(): Record<string, any> {\n    let chatStorageString: string = '';\n    if (isUniFrameWork) {\n      chatStorageString = TUIGlobal.getStorageSync(ChatStorage.CHAT_STORAGE_KEY) || '';\n    } else {\n      chatStorageString = localStorage.getItem(ChatStorage.CHAT_STORAGE_KEY) || '';\n    }\n    if (!chatStorageString) {\n      return {};\n    }\n    try {\n      this.chatStorage = JSON.parse(chatStorageString);\n    } catch (error) {\n      this.chatStorage = {};\n    }\n    return this.chatStorage as Record<string, any>;\n  }\n}\n\nexport default ChatStorage.getInstance();\n"],"names":["isUniFrameWork","TUIGlobal"],"mappings":";;;;;;;;;AAQA,MAAM,eAAN,MAAM,aAAoC;AAAA,EAMhC,cAAc;AAFd,uCAA0C;AAAA,EAE1B;AAAA,EAExB,OAAc,cAA2B;AACnC,QAAA,CAAC,aAAY,UAAU;AACb,mBAAA,WAAW,IAAI;IAC7B;AACA,WAAO,aAAY;AAAA,EACrB;AAAA,EAEO,eAAe,KAA8B;AAC9C,QAAA,CAAC,KAAK,aAAa;AAChB,WAAA,cAAc,KAAK;IAC1B;AACA,QAAI,KAAK;AACA,aAAA,KAAK,YAAY,GAAG;AAAA,IAAA,OACtB;AACC,YAAA,IAAI,MAAM,iBAAiB;AAAA,IACnC;AAAA,EACF;AAAA,EAEO,eAAe,KAAa,OAAkB;AAC/C,QAAA,CAAC,KAAK,aAAa;AAChB,WAAA,cAAc,KAAK;IAC1B;AACK,SAAA,YAAY,GAAG,IAAI;AACpB,QAAA;AACF,UAAIA,2DAAgB;AAClBC,wBAAU,eAAe,aAAY,kBAAkB,KAAK,UAAU,KAAK,WAAW,CAAC;AAAA,MAAA,OAClF;AACL,qBAAa,QAAQ,aAAY,kBAAkB,KAAK,UAAU,KAAK,WAAW,CAAC;AAAA,MACrF;AAAA,aACO,OAAO;AACR,YAAA,IAAI,MAAM,0BAA0B;AAAA,IAC5C;AAAA,EACF;AAAA,EAEQ,iCAAsD;AAC5D,QAAI,oBAA4B;AAChC,QAAID,2DAAgB;AAClB,0BAAoBC,cAAU,EAAA,eAAe,aAAY,gBAAgB,KAAK;AAAA,IAAA,OACzE;AACL,0BAAoB,aAAa,QAAQ,aAAY,gBAAgB,KAAK;AAAA,IAC5E;AACA,QAAI,CAAC,mBAAmB;AACtB,aAAO;IACT;AACI,QAAA;AACG,WAAA,cAAc,KAAK,MAAM,iBAAiB;AAAA,aACxC,OAAO;AACd,WAAK,cAAc;IACrB;AACA,WAAO,KAAK;AAAA,EACd;AACF;AA1DE,cADI,cACW,YAA+B;AAC9C,cAFI,cAEW,oBAA2B;AAF5C,IAAM,cAAN;AA6DA,MAAe,cAAA,YAAY,YAAY;;"}