{"version":3,"file":"index-uniapp.js","sources":["pages-ai-desk/ai-desk-customer-uniapp/components/CustomerServiceChat/message-list/message-tool/index-uniapp.vue","E:/HBuilderX/plugins/uniapp-cli-vite/uniComponent:/RDovSkFWQUVFL215ZmxpZXMvdW5pYXBwLWFwcC91bmlhcHAvcGFnZXMtYWktZGVzay9haS1kZXNrLWN1c3RvbWVyLXVuaWFwcC9jb21wb25lbnRzL0N1c3RvbWVyU2VydmljZUNoYXQvbWVzc2FnZS1saXN0L21lc3NhZ2UtdG9vbC9pbmRleC11bmlhcHAudnVl"],"sourcesContent":["<template>\n  <div\n    v-if=\"!isAllActionItemInvalid && !messageItem.hasRiskContent\"\n    ref=\"messageToolDom\"\n    :class=\"['dialog-item', 'dialog-item-h5']\"\n  >\n    <div\n      class=\"dialog-item-list\"\n      :class=\"'dialog-item-list-h5'\"\n    >\n      <template v-for=\"(item, index) in actionItems\">\n        <div\n          v-if=\"item.renderCondition()\"\n          :key=\"item.key\"\n          class=\"list-item\"\n          @click=\"getFunction(index)\"\n          @mousedown=\"beforeCopy(item.key)\"\n        >\n          <Icon\n            :file=\"item.iconUrl\"\n            :size=\"'15px'\"\n          />\n          <span class=\"list-item-text\">{{ item.text }}</span>\n        </div>\n      </template>\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\" setup>\nimport TUIChatEngine, {\n  TUIStore,\n  TUITranslateService,\n  IMessageModel,\n} from '@tencentcloud/chat-uikit-engine';\nimport { TUIGlobal } from '@tencentcloud/universal-api';\nimport vue from '../../../../adapter-vue';\nimport Icon from '../../../common/Icon.vue';\nimport { Toast, TOAST_TYPE } from '../../../common/Toast/index-uniapp';\nimport delIcon from '../../../../assets/msg-del.svg';\nimport copyIcon from '../../../../assets/msg-copy.svg';\nimport quoteIcon from '../../../../assets/msg-quote.svg';\nimport revokeIcon from '../../../../assets/msg-revoke.svg';\nimport imgIcon from '../../../../assets/image-uni.png';\nimport { CUSTOM_MESSAGE_SRC } from '../../../../constant';\nimport { enableSampleTaskStatus } from '../../../../utils/enableSampleTaskStatus';\nimport { transformTextWithKeysToEmojiNames } from '../../emoji-config';\nimport { isH5, isUniFrameWork } from '../../../../utils/env';\nimport {JSONToObject} from '../../../../utils/index';\nconst { ref, watchEffect, computed } = vue;\n\n// uni-app conditional compilation will not run the following code\n\n\n\n\ninterface IProps {\n  messageItem: IMessageModel;\n}\n\nconst props = withDefaults(defineProps<IProps>(), {\n  messageItem: () => ({} as IMessageModel),\n});\n\nconst TYPES = TUIChatEngine.TYPES;\n\nconst actionItems = ref([\n  {\n    key: 'copy',\n    text: TUITranslateService.t('TUIChat.复制'),\n    iconUrl: copyIcon,\n    renderCondition() {\n      if (!message.value) return false;\n      return message.value.type === TYPES.MSG_TEXT;\n    },\n    clickEvent: copyMessage,\n  },\n  {\n    key: 'revoke',\n    text: TUITranslateService.t('TUIChat.撤回'),\n    iconUrl: revokeIcon,\n    renderCondition() {\n      if (!message.value) return false;\n      return message.value.flow === 'out' && message.value.status === 'success';\n    },\n    clickEvent: revokeMessage,\n  },\n  // {\n  //   key: 'delete',\n  //   text: TUITranslateService.t('TUIChat.删除'),\n  //   iconUrl: delIcon,\n  //   renderCondition() {\n  //     if (!message.value) return false;\n  //     return message.value.status === 'success';\n  //   },\n  //   clickEvent: deleteMessage,\n  // },\n  // {\n  //   key: 'quote',\n  //   text: TUITranslateService.t('TUIChat.引用'),\n  //   iconUrl: quoteIcon,\n  //   renderCondition() {\n  //     if (!message.value) return false;\n  //     const _message = TUIStore.getMessageModel(message.value.ID);\n  //     return message.value.status === 'success' && !_message.getSignalingInfo();\n  //   },\n  //   clickEvent: quoteMessage,\n  // },\n  // {\n  //   key:'image',\n  //   text:'查看图片',\n  //   iconUrl:imgIcon,\n  //   renderCondition() {\n  //     if (!message.value || !isUniFrameWork) return false;\n  //     return message.value.type === TYPES.MSG_CUSTOM && JSONToObject(message.value.payload.data).src === CUSTOM_MESSAGE_SRC.RICH_TEXT;\n  //   },\n  //   clickEvent:showImageInRichText,\n  // }\n]);\n\nconst message = ref<IMessageModel>();\nconst messageToolDom = ref<HTMLElement>();\n\nwatchEffect(() => {\n  message.value = TUIStore.getMessageModel(props.messageItem.ID);\n});\n\nconst isAllActionItemInvalid = computed(() => {\n  for (let i = 0; i < actionItems.value.length; ++i) {\n    if (actionItems.value[i].renderCondition()) {\n      return false;\n    }\n  }\n  return true;\n});\n\nfunction getFunction(index: number) {\n  // Compatible with Vue2 and WeChat Mini Program syntax, dynamic binding is not allowed.\n  actionItems.value[index].clickEvent();\n}\n\nfunction openMessage() {\n  let url = '';\n  switch (message.value?.type) {\n    case TUIChatEngine.TYPES.MSG_FILE:\n      url = message.value.payload.fileUrl;\n      break;\n    case TUIChatEngine.TYPES.MSG_VIDEO:\n      url = message.value.payload.remoteVideoUrl;\n      break;\n    case TUIChatEngine.TYPES.MSG_IMAGE:\n      url = message.value.payload.imageInfoArray[0].url;\n      break;\n  }\n  window?.open(url, '_blank');\n}\n\nfunction revokeMessage() {\n  if (!message.value) return;\n  const messageModel = TUIStore.getMessageModel(message.value.ID);\n  messageModel\n    .revokeMessage()\n    .then(() => {\n      enableSampleTaskStatus('revokeMessage');\n    })\n    .catch((error: any) => {\n      if (error.code === 20016) {\n        const message = TUITranslateService.t('TUIChat.已过撤回时限');\n        Toast({\n          message,\n          type: TOAST_TYPE.ERROR,\n        });\n      }\n    });\n}\n\nfunction deleteMessage() {\n  if (!message.value) return;\n  const messageModel = TUIStore.getMessageModel(message.value.ID);\n  messageModel.deleteMessage();\n}\n\nasync function copyMessage() {\n  TUIGlobal?.setClipboardData({\n    data: transformTextWithKeysToEmojiNames(message.value?.payload?.text),\n  });\n}\n\nfunction beforeCopy(key: string) {\n  // uni-app and h5 only support copy full message text\n  if (key !== 'copy' || isH5) {\n    return;\n  }\n}\n\nfunction quoteMessage() {\n  if (!message.value) return;\n  message.value.quoteMessage();\n}\n\n// function showImageInRichText(){\n//   const imgList:Array<string> = [];\n//   const rendererMD = new marked.Renderer();\n//   marked.setOptions({\n//       renderer: rendererMD,\n//       gfm: true,\n//       breaks: true,\n//       pedantic: false,\n//       sanitize: false,\n//       smartLists: true,\n//       smartypants: false,\n//     });\n//   rendererMD.image = (href, title, text) => {\n//         imgList.push(href);\n//         return ''\n//       }\n//   const text = marked.parse(message.value.payload.data);\n//   uni.previewImage({\n//     current: '0',\n//     urls: imgList,\n//\n\n\n//   });\n// }\n\ndefineExpose({\n  messageToolDom,\n});\n</script>\n\n<style lang=\"scss\" scoped>\n@import \"../../style/common\";\n\n.dialog-item-web {\n  background: #fff;\n  border-radius: 8px;\n  border: 1px solid #e0e0e0;\n  padding: 12px 0;\n\n  .dialog-item-list {\n    display: flex;\n    align-items: baseline;\n    white-space: nowrap;\n    flex-wrap: wrap;\n    max-width: 280px;\n\n    .list-item {\n      padding: 4px 12px;\n      display: flex;\n      flex-direction: row;\n      align-items: center;\n\n      .list-item-text {\n        padding-left: 4px;\n        font-size: 12px;\n        line-height: 17px;\n      }\n    }\n  }\n}\n\n.dialog-item-h5 {\n  @extend .dialog-item-web;\n\n  padding: 0;\n\n  .dialog-item-list {\n    margin: 10px;\n    white-space: nowrap;\n    flex-wrap: wrap;\n    max-width: 280px;\n\n    .list-item {\n      padding: 0 8px;\n      display: flex;\n      flex-direction: column;\n      align-items: center;\n      color: #4f4f4f;\n\n      .list-item-text {\n        padding-left: 0;\n      }\n    }\n  }\n}\n</style>\n","import Component from 'D:/JAVAEE/myflies/uniapp-app/uniapp/pages-ai-desk/ai-desk-customer-uniapp/components/CustomerServiceChat/message-list/message-tool/index-uniapp.vue'\nwx.createComponent(Component)"],"names":["vue","TUIChatEngine","TUITranslateService","copyIcon","revokeIcon","TUIStore","enableSampleTaskStatus","message","Toast","TOAST_TYPE","TUIGlobal","transformTextWithKeysToEmojiNames","isH5"],"mappings":";;;;;;;;;;;;AAqCA,MAAA,OAAiB,MAAA;;;;;;;AAYjB,UAAM,EAAE,KAAK,aAAa,SAAA,IAAaA,4CAAAA;AAWvC,UAAM,QAAQ;AAId,UAAM,QAAQC,cAAc,GAAA;AAE5B,UAAM,cAAc,IAAI;AAAA,MACtB;AAAA,QACE,KAAK;AAAA,QACL,MAAMC,cAAAA,GAAoB,EAAE,YAAY;AAAA,QACxC,SAASC,cAAA;AAAA,QACT,kBAAkB;AAChB,cAAI,CAAC,QAAQ;AAAc,mBAAA;AACpB,iBAAA,QAAQ,MAAM,SAAS,MAAM;AAAA,QACtC;AAAA,QACA,YAAY;AAAA,MACd;AAAA,MACA;AAAA,QACE,KAAK;AAAA,QACL,MAAMD,cAAAA,GAAoB,EAAE,YAAY;AAAA,QACxC,SAASE,cAAA;AAAA,QACT,kBAAkB;AAChB,cAAI,CAAC,QAAQ;AAAc,mBAAA;AAC3B,iBAAO,QAAQ,MAAM,SAAS,SAAS,QAAQ,MAAM,WAAW;AAAA,QAClE;AAAA,QACA,YAAY;AAAA,MACd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAAA,CAgCD;AAED,UAAM,UAAU;AAChB,UAAM,iBAAiB;AAEvB,gBAAY,MAAM;AAChB,cAAQ,QAAQC,iBAAS,gBAAgB,MAAM,YAAY,EAAE;AAAA,IAAA,CAC9D;AAEK,UAAA,yBAAyB,SAAS,MAAM;AAC5C,eAAS,IAAI,GAAG,IAAI,YAAY,MAAM,QAAQ,EAAE,GAAG;AACjD,YAAI,YAAY,MAAM,CAAC,EAAE,mBAAmB;AACnC,iBAAA;AAAA,QACT;AAAA,MACF;AACO,aAAA;AAAA,IAAA,CACR;AAED,aAAS,YAAY,OAAe;AAEtB,kBAAA,MAAM,KAAK,EAAE,WAAW;AAAA,IACtC;AAkBA,aAAS,gBAAgB;AACvB,UAAI,CAAC,QAAQ;AAAO;AACpB,YAAM,eAAeA,cAAAA,GAAS,gBAAgB,QAAQ,MAAM,EAAE;AAE3D,mBAAA,gBACA,KAAK,MAAM;AACVC,sEAAA,uBAAuB,eAAe;AAAA,MAAA,CACvC,EACA,MAAM,CAAC,UAAe;AACjB,YAAA,MAAM,SAAS,OAAO;AAClBC,gBAAAA,WAAUL,cAAAA,GAAoB,EAAE,gBAAgB;AAChDM,qFAAA;AAAA,YACJ,SAAAD;AAAAA,YACA,MAAME,8DAAW,WAAA;AAAA,UAAA,CAClB;AAAA,QACH;AAAA,MAAA,CACD;AAAA,IACL;AAQA,mBAAe,cAAc;;AAC3BC,0BAAAA,MAAAA,mBAAW,iBAAiB;AAAA,QAC1B,MAAMC,kFAAAA,mCAAkC,mBAAQ,UAAR,mBAAe,YAAf,mBAAwB,IAAI;AAAA,MAAA;AAAA,IAExE;AAEA,aAAS,WAAW,KAAa;AAE3B,UAAA,QAAQ,UAAUC,iDAAM;AAC1B;AAAA,MACF;AAAA,IACF;AAiCa,aAAA;AAAA,MACX;AAAA,IAAA,CACD;;;;;;;;;;;;;;;;;;;;;;;;;;ACnOD,GAAG,gBAAgB,SAAS;"}