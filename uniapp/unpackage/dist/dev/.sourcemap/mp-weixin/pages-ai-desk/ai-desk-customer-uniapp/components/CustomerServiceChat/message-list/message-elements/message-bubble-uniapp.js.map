{"version":3,"file":"message-bubble-uniapp.js","sources":["pages-ai-desk/ai-desk-customer-uniapp/components/CustomerServiceChat/message-list/message-elements/message-bubble-uniapp.vue","E:/HBuilderX/plugins/uniapp-cli-vite/uniComponent:/RDovSkFWQUVFL215ZmxpZXMvdW5pYXBwLWFwcC91bmlhcHAvcGFnZXMtYWktZGVzay9haS1kZXNrLWN1c3RvbWVyLXVuaWFwcC9jb21wb25lbnRzL0N1c3RvbWVyU2VydmljZUNoYXQvbWVzc2FnZS1saXN0L21lc3NhZ2UtZWxlbWVudHMvbWVzc2FnZS1idWJibGUtdW5pYXBwLnZ1ZQ"],"sourcesContent":["<template>\n  <div :class=\"containerClassNameList\">\n    <div\n      :class=\"{\n        'control-reverse': message.flow === 'out',\n      }\"\n    >\n      <!-- message-bubble-container -->\n      <div class=\"message-bubble-content\">\n        <div\n          class=\"message-bubble-main-content\"\n          :class=\"[message.flow === 'in' ? '' : 'reverse']\"\n          @longpress=\"handleToggle\"\n          @touchstart=\"handleTouchStart\"\n          @touchend=\"handleTouchEnd\"\n          @mouseover=\"handleTouchEnd\"\n        >\n          <Avatar\n            v-if=\"isPC && showAvatar === 1\"\n            useSkeletonAnimation\n            :url=\"avatarUrl\"\n            :style=\"{ flex: '0 0 auto' }\"\n          />\n          <main\n            class=\"message-body\"\n            @click.stop\n          >\n            <div\n              v-if=\"\n                isPC && showNickName === 1\n              \"\n              class=\"message-body-nick-name\"\n            >\n              {{ nickName }}\n            </div>\n            <div\n              :class=\"[\n                'message-body-main',\n                message.flow === 'out' && 'message-body-main-reverse',\n              ]\"\n            >\n              <div\n                :class=\"[\n                  'blink',\n                  'message-body-content',\n                  message.flow === 'out' ? 'content-out' : 'content-in',\n                  message.hasRiskContent && 'content-has-risk',\n                  isNoPadding ? 'content-no-padding' : '',\n                  isNoPadding && isBlink ? 'blink-shadow' : '',\n                  !isNoPadding && isBlink ? 'blink-content' : '',\n                  isMultiBranchMsg ? 'multi-branch-message': '',\n                  (isProductCardOrOrderMessage ? 'product-order-message-bubble' : ''),\n                ]\"\n              >\n              <!-- message extra area -->\n                <div class=\"message-bubble-extra-content\">\n                  <!-- extra: message quote -->\n                  <MessageQuote\n                    :class=\"message.flow === 'out' ? 'reverse' : 'flex-row'\"\n                    :message=\"message\"\n                    @blinkMessage=\"blinkMessage\"\n                    @scrollTo=\"scrollTo\"\n                  />\n                </div>\n                <div class=\"content-main\">\n                  <img\n                    v-if=\"\n                      (message.type === TYPES.MSG_IMAGE ||\n                        message.type === TYPES.MSG_VIDEO) &&\n                        message.hasRiskContent\n                    \"\n                    :class=\"[\n                      'message-risk-replace',\n                      'message-risk-replace-h5',\n                    ]\"\n                    :src=\"riskImageReplaceUrl\"\n                  >\n                  <template v-else>\n                    <slot />\n                  </template>\n                </div>\n                <!-- Risk Content Tips -->\n                <div\n                  v-if=\"message.hasRiskContent\"\n                  class=\"content-has-risk-tips\"\n                >\n                  {{ riskContentText }}\n                </div>\n              </div>\n              <!-- audio unplay mark -->\n              <div\n                v-if=\"isDisplayUnplayMark\"\n                class=\"audio-unplay-mark\"\n              />\n              <!-- Fail Icon -->\n              <div\n                v-if=\"message.status === 'fail' || message.hasRiskContent\"\n                class=\"message-label fail\"\n                @click=\"resendMessage()\"\n              >\n                !\n              </div>\n              <!-- Loading Icon -->\n              <Icon\n                v-if=\"\n                  message.status === 'unSend' &&\n                    needLoadingIconMessageType.includes(message.type)\n                \"\n                class=\"message-label loading-circle\"\n                :file=\"loadingIcon\"\n                :width=\"'15px'\"\n                :height=\"'15px'\"\n              />\n              <!-- Read & Unread -->\n              <ReadStatus\n                class=\"message-label align-self-bottom\"\n                :message=\"shallowCopyMessage(message)\"\n              />\n            </div>\n          </main>\n        </div>\n\n      </div>\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\" setup>\nimport vue from '../../../../adapter-vue';\nimport TUIChatEngine, {\n  TUITranslateService,\n  IMessageModel,\n} from '@tencentcloud/chat-uikit-engine';\nimport Icon from '../../../common/Icon.vue';\nimport ReadStatus from './read-status/index.vue';\nimport MessageQuote from './message-quote/index-uniapp.vue';\nimport Avatar from '../../../common/Avatar/index.vue';\nimport loadingIcon from '../../../../assets/loading.png';\nimport { shallowCopyMessage } from '../../../../utils/utils';\nimport { isPC } from '../../../../utils/env';\nimport { JSONToObject } from '../../../../utils/index';\nimport state from '../../../../utils/state.js';\nimport { CUSTOM_MESSAGE_SRC } from '../../../../constant';\nconst { computed, toRefs } = vue;\n\ninterface IProps {\n  messageItem: IMessageModel;\n  content?: any;\n  classNameList?: string[];\n  blinkMessageIDList?: string[];\n  isAudioPlayed?: boolean | undefined;\n}\n\ninterface IEmits {\n  (e: 'resendMessage'): void;\n  (e: 'blinkMessage', messageID: string): void;\n  // Only for uni-app\n  (e: 'scrollTo', scrollHeight: number): void;\n  (e:'handleTouchStart'):void;\n  (e:'handleTouchEnd'):void;\n  (e:'handleToggleMessageItem'):void;\n}\n\nconst emits = defineEmits<IEmits>();\n\nconst props = withDefaults(defineProps<IProps>(), {\n  isAudioPlayed: false,\n  messageItem: () => ({} as IMessageModel),\n  content: () => ({}),\n  blinkMessageIDList: () => [],\n  classNameList: () => [],\n});\n\nconst TYPES = TUIChatEngine.TYPES;\nconst riskImageReplaceUrl\n  = 'https://web.sdk.qcloud.com/component/TUIKit/assets/has_risk_default.png';\nconst needLoadingIconMessageType = [\n  TYPES.MSG_LOCATION,\n  TYPES.MSG_TEXT,\n  TYPES.MSG_CUSTOM,\n  TYPES.MSG_MERGER,\n  TYPES.MSG_FACE,\n];\n\nconst { blinkMessageIDList, messageItem: message } = toRefs(props);\nconst {\n  showAvatar,\n  showNickName,\n  robotAvatar,\n  staffAvatar,\n  userAvatar,\n  robotNickName,\n  staffNickName,\n  userNickName,\n} = state.get('avatarNickName');\n\nconst isDisplayUnplayMark = computed<boolean>(() => {\n  return (\n    message.value.flow === 'in'\n    && message.value.status === 'success'\n    && message.value.type === TYPES.MSG_AUDIO\n    && !props.isAudioPlayed\n  );\n});\n\nconst isMultiBranchMsg = computed(() => {\n  if (message.value?.type === \"TIMCustomElem\") {\n    const src = JSON.parse(message.value.payload.data).src;\n    if (src === CUSTOM_MESSAGE_SRC.MULTI_BRANCH || src === CUSTOM_MESSAGE_SRC.BRANCH || src === CUSTOM_MESSAGE_SRC.BRANCH_NUMBER) {\n      return true;\n    }\n  }\n  return false;\n});\n\nfunction isFromRobot(cloudCustomData: string) {\n  try {\n    const jsonObj = JSONToObject(cloudCustomData);\n    return jsonObj.hasOwnProperty(\"role\") && jsonObj.role === \"robot\";\n  } catch (e) {\n    return false;\n  }\n}\n\nconst avatarUrl = computed(() => {\n  let url = '';\n  if (message.value?.flow === 'in') {\n    if (isFromRobot(message.value?.cloudCustomData)) {\n      url = robotAvatar || message.value?.avatar || customerAvatar;\n    } else {\n      url = staffAvatar || message.value?.avatar;\n    }\n  } else {\n    url = userAvatar || message.value?.avatar || '';\n  }\n  return url;\n});\n\nconst nickName = computed(() => {\n  let nick = '';\n  if (message.value?.flow === 'in') {\n    if (isFromRobot(message.value?.cloudCustomData)) {\n      nick = robotNickName || props.content.showName;\n    } else {\n      nick = staffNickName || props.content.showName;\n    }\n  } else {\n    nick = userNickName || props.content.showName;\n  }\n  return nick;\n});\n\nconst containerClassNameList = computed(() => {\n  return ['message-bubble', ...props.classNameList];\n});\n\nconst isProductCardOrOrderMessage = computed(() => {\n  if (message.value?.type == \"TIMCustomElem\") {\n    const src = JSON.parse(message.value.payload.data).src;\n    if (src === CUSTOM_MESSAGE_SRC.PRODUCT_CARD || src === CUSTOM_MESSAGE_SRC.ORDER) {\n      return true;\n    }\n  }\n  return false;\n});\n\nconst isNoPadding = computed(() => {\n  return [TYPES.MSG_IMAGE, TYPES.MSG_VIDEO, TYPES.MSG_MERGER].includes(\n    message.value.type,\n  );\n});\n\nconst riskContentText = computed<string>(() => {\n  let content = TUITranslateService.t('TUIChat.涉及敏感内容') + ', ';\n  if (message.value.flow === 'out') {\n    content += TUITranslateService.t('TUIChat.发送失败');\n  } else {\n    content += TUITranslateService.t(\n      message.value.type === TYPES.MSG_AUDIO\n        ? 'TUIChat.无法收听'\n        : 'TUIChat.无法查看',\n    );\n  }\n  return content;\n});\n\nconst isBlink = computed(() => {\n  if (message.value?.ID) {\n    return blinkMessageIDList?.value?.includes(message.value.ID);\n  }\n  return false;\n});\n\nfunction resendMessage() {\n  if (!message.value?.hasRiskContent) {\n    emits('resendMessage');\n  }\n}\n\nfunction blinkMessage(messageID: string) {\n  emits('blinkMessage', messageID);\n}\n\nfunction scrollTo(scrollHeight: number) {\n  emits('scrollTo', scrollHeight);\n}\nfunction handleToggle(){\n  uni.__f__('log','at pages-ai-desk/ai-desk-customer-uniapp/components/CustomerServiceChat/message-list/message-elements/message-bubble-uniapp.vue:308','handleToggle');\n  emits('handleToggleMessageItem');\n}\nfunction handleTouchStart(){\n  uni.__f__('log','at pages-ai-desk/ai-desk-customer-uniapp/components/CustomerServiceChat/message-list/message-elements/message-bubble-uniapp.vue:312','handleTouchStart');\n  emits('handleTouchStart');\n}\nfunction handleTouchEnd(){\n  emits('handleTouchEnd');\n}\n\n\n</script>\n\n<style lang=\"scss\" scoped>\n:not(not) {\n  display: flex;\n  flex-direction: column;\n  min-width: 0;\n  box-sizing: border-box;\n}\n\n.flex-row {\n  display: flex;\n}\n\n.reverse {\n  display: flex;\n  flex-direction: row-reverse;\n  justify-content: flex-start;\n}\n\n.message-bubble {\n  padding: 10px 15px;\n  display: flex;\n  flex-direction: row;\n  user-select: none;\n  -webkit-touch-callout: none;\n  -webkit-user-select: none;\n  -khtml-user-select: none;\n  -moz-user-select: none;\n  -ms-user-select: none;\n\n  &.multiple-selected {\n    background-color: #f0f0f0;\n  }\n\n  .multiple-select-radio {\n    margin-right: 12px;\n    flex: 0 0 auto;\n  }\n\n  .control-reverse {\n    flex: 1 1 auto;\n    flex-direction: row-reverse;\n  }\n\n  .message-bubble-main-content {\n    display: flex;\n    flex-direction: row;\n\n    .message-avatar {\n      display: block;\n      width: 36px;\n      height: 36px;\n      border-radius: 5px;\n      flex: 0 0 auto;\n    }\n\n    .message-body {\n      display: flex;\n      flex: 0 1 auto;\n      flex-direction: column;\n      align-items: flex-start;\n      margin: 0 8px;\n\n      .message-body-nick-name {\n        display: block;\n        margin-bottom: 4px;\n        font-size: 12px;\n        color: #999;\n        max-width: 150px;\n        overflow: hidden;\n        text-overflow: ellipsis;\n        white-space: nowrap;\n      }\n\n      .message-body-main {\n        max-width: 100%;\n        display: flex;\n        flex-direction: row;\n        min-width: 0;\n        box-sizing: border-box;\n\n        &-reverse {\n          flex-direction: row-reverse;\n        }\n\n        .audio-unplay-mark {\n          flex: 0 0 auto;\n          width: 5px;\n          height: 5px;\n          border-radius: 50%;\n          background-color: #f00;\n          margin: 5px;\n        }\n\n        .message-body-content {\n          display: flex;\n          flex-direction: column;\n          min-width: 0;\n          box-sizing: border-box;\n          padding: 16px;\n          font-size: 14px;\n          color: #000;\n          letter-spacing: 0;\n          word-wrap: break-word;\n          word-break: break-all;\n          position: relative;\n\n          .content-main {\n            box-sizing: border-box;\n            display: flex;\n            flex-direction: column;\n            flex-shrink: 0;\n            align-content: flex-start;\n            border: 0 solid black;\n            margin: 0;\n            padding: 0;\n            min-width: 0;\n\n            .message-risk-replace {\n              width: 130px;\n              height: 130px;\n            }\n          }\n\n          .content-has-risk-tips {\n            font-size: 12px;\n            color: #fa5151;\n            font-family: PingFangSC-Regular;\n            margin-top: 5px;\n            border-top: 1px solid #e5c7c7;\n            padding-top: 5px;\n          }\n        }\n\n        .content-in {\n          background: #ffffff;\n          border-radius: 0 10px 10px;\n        }\n\n        .product-order-message-bubble {\n          background: #ffffff !important ;\n        }\n\n        .content-out {\n          color:#fff;\n          background: linear-gradient(26deg, #1C66E5 2.07%, #03C8FD 152.75%);\n          border-radius: 10px 0 10px 10px;\n        }\n\n        .multi-branch-message {\n          background-color: transparent;\n          border-radius: 0 10px 10px;\n          padding: 0px;\n        }\n\n        .content-no-padding {\n          padding: 0;\n          background: transparent;\n          border-radius: 10px;\n          overflow: hidden;\n        }\n\n        .content-no-padding.content-has-risk {\n          padding: 12px;\n        }\n\n        .content-has-risk {\n          background: rgba(250, 81, 81, 0.16);\n        }\n\n        .blink-shadow {\n          @keyframes shadow-blink {\n            50% {\n              box-shadow: rgba(255, 156, 25, 1) 0 0 10px 0;\n            }\n          }\n\n          box-shadow: rgba(255, 156, 25, 0) 0 0 10px 0;\n          animation: shadow-blink 1s linear 3;\n        }\n\n        .blink-content {\n          @keyframes reference-blink {\n            50% {\n              background-color: #ff9c19;\n            }\n          }\n\n          animation: reference-blink 1s linear 3;\n        }\n\n        .message-label {\n          align-self: flex-end;\n          font-family: PingFangSC-Regular;\n          font-size: 12px;\n          color: #b6b8ba;\n          word-break: keep-all;\n          flex: 0 0 auto;\n          margin: 0 8px;\n\n          &.fail {\n            width: 15px;\n            height: 15px;\n            border-radius: 15px;\n            background: red;\n            color: #fff;\n            display: flex;\n            justify-content: center;\n            align-items: center;\n            cursor: pointer;\n          }\n\n          &.loading-circle {\n            opacity: 0;\n            animation: circle-loading 2s linear 1s infinite;\n          }\n\n          @keyframes circle-loading {\n            0% {\n              transform: rotate(0);\n              opacity: 1;\n            }\n\n            100% {\n              opacity: 1;\n              transform: rotate(360deg);\n            }\n          }\n        }\n\n        .align-self-bottom {\n          align-self: flex-end;\n        }\n      }\n    }\n  }\n\n  .reverse {\n    display: flex;\n    flex-direction: row-reverse;\n    justify-content: flex-start;\n  }\n\n  .message-bubble-extra-content {\n    display: flex;\n    flex-direction: column;\n  }\n}\n</style>\n","import Component from 'D:/JAVAEE/myflies/uniapp-app/uniapp/pages-ai-desk/ai-desk-customer-uniapp/components/CustomerServiceChat/message-list/message-elements/message-bubble-uniapp.vue'\nwx.createComponent(Component)"],"names":["vue","TUIChatEngine","state","CUSTOM_MESSAGE_SRC","JSONToObject","TUITranslateService","uni"],"mappings":"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"}