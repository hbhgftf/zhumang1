{"version":3,"file":"elective.js","sources":["pages/index/elective.vue","E:/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvaW5kZXgvZWxlY3RpdmUudnVl"],"sourcesContent":["<!-- 模板部分 -->\n<template>\n  <view class=\"volunteer-container\">\n    <!-- 非志愿者显示注册按钮 -->\n    <view v-if=\"!isVolunteer\" class=\"register-section\">\n      <view class=\"register-header\">\n        <text class=\"register-title\">成为志愿者</text>\n        <text class=\"register-subtitle\">加入我们，一起帮助他人</text>\n      </view>\n      <button class=\"register-btn\" @tap=\"goToRegister\">成为志愿者</button>\n    </view>\n\n    <!-- 志愿者显示服务内容 -->\n    <block v-else>\n    <!-- 状态控制栏 -->\n    <view class=\"status-bar\">\n      <text class=\"status-title\">服务状态</text>\n        <!-- 真实的uni-switch 组件 -->\n        <switch \n          :checked=\"isOnline\" \n          @change=\"toggleOnlineStatus\" \n          color=\"#1AAD19\"\n          class=\"status-switch\"\n        />\n        <text class=\"status-text\">{{ isOnline ? '在线' : '离线' }}</text>\n    </view>\n\n    <!-- 服务范围选择 -->\n    <view class=\"service-scope\">\n      <text class=\"section-title\">可提供的帮助类型（多选）</text>\n      <view class=\"tag-container\">\n        <view class=\"tag mock-tag active\" @tap=\"goToVideoAssist\">视频协助</view>\n        <view class=\"tag mock-tag\">出行预约</view>\n        <view class=\"tag mock-tag\">政策咨询</view>\n      </view>\n    </view>\n\n    <!-- 任务列表 -->\n    <view class=\"task-list\">\n      <text class=\"section-title\">最新求助请求</text>\n      <view class=\"task-item mock-task urgent\">\n        <view class=\"task-header\">\n          <text class=\"task-type\">紧急求助</text>\n          <text class=\"task-time\">08/20 14:30</text>\n        </view>\n        <text class=\"task-content\">需要协助识别药品有效期</text>\n        <view class=\"response-btn mock-btn\">立即响应</view>\n      </view>\n    </view>\n    </block>\n  </view>\n</template>\n\n<script>\nexport default {\n  data() {\n    return {\n      isVolunteer: false,\n      isOnline: false // 新增：志愿者在线状态\n    }\n  },\n  onLoad() {\n    this.checkVolunteerStatus()\n  },\n  onShow() {\n    // 每次页面显示时重新检查状态\n    this.checkVolunteerStatus()\n  },\n  methods: {\n    // 检查志愿者状态并获取在线状态\n    async checkVolunteerStatus() {\n      const userInfo = uni.getStorageSync('userInfo')\n      \n      if (!userInfo || typeof userInfo === 'string') {\n         // 如果userInfo不存在或不是对象，则不是志愿者且无法获取openid\n        this.isVolunteer = false\n        this.isOnline = false // 未登录或信息异常，设置为离线\n        return\n      }\n\n      // 检查角色\n      if (userInfo.role === '志愿者') {\n        this.isVolunteer = true\n        // 如果是志愿者，则获取在线状态\n        try {\n          const res = await uni.request({\n            url: `${this.$config.baseUrl}/api/volunteer/status/${userInfo.openid}`,\n            method: 'GET',\n            header: {'Authorization': `Bearer ${userInfo.token}`}\n          });\n\n          if (res.data.code === 200) {\n            this.isOnline = res.data.data; // 后端返回的是布尔值\n          } else {\n            console.error('获取志愿者在线状态失败:', res.data.msg);\n            // 获取失败，可以给用户提示或将状态设为默认离线\n            this.isOnline = false;\n             uni.showToast({\n              title: res.data.msg || '获取状态失败',\n              icon: 'none'\n            });\n          }\n        } catch (error) {\n          console.error('请求获取志愿者在线状态失败:', error);\n          this.isOnline = false;\n           uni.showToast({\n            title: '请求获取状态失败',\n            icon: 'none'\n          });\n        }\n\n      } else {\n        this.isVolunteer = false\n        this.isOnline = false // 不是志愿者，设置为离线\n      }\n    },\n\n    // 切换志愿者在线状态\n    async toggleOnlineStatus(event) {\n       const userInfo = uni.getStorageSync('userInfo')\n       if (!userInfo || userInfo.role !== '志愿者') {\n         uni.showToast({ title: '您不是志愿者', icon: 'none' });\n         // 回滚开关状态\n         this.$nextTick(() => { this.isOnline = !event.detail.value; });\n         return;\n       }\n\n      const newStatus = event.detail.value; // 开关的新状态 (true/false)\n      const openid = userInfo.openid;\n\n      uni.showLoading({ title: '更新状态中...' });\n\n      // 将参数附加到URL上\n      const url = `${this.$config.baseUrl}/api/volunteer/status?openid=${openid}&isOnline=${newStatus}`;\n      \n      console.log('请求URL:', url); // 打印完整的请求URL\n\n      try {\n        const res = await uni.request({\n          url: url, // 使用带有参数的URL\n          method: 'POST',\n          // data: {}, // POST请求通常可以没有body，或者发送空对象\n           header: {\n               'Authorization': `Bearer ${userInfo.token}`\n               // 对于URL参数，通常不需要指定 Content-Type\n            }\n        });\n\n        if (res.data.code === 200) {\n          this.isOnline = newStatus; // 成功后更新前端状态\n          uni.showToast({ title: '状态更新成功', icon: 'success' });\n        } else {\n          console.error('更新志愿者在线状态失败:', res.data.msg);\n          // 更新失败，回滚开关状态\n          this.$nextTick(() => { this.isOnline = !newStatus; });\n           uni.showToast({ \n             title: res.data.msg || '更新状态失败', \n             icon: 'none' \n           });\n        }\n      } catch (error) {\n        console.error('请求更新志愿者在线状态失败:', error);\n        // 请求失败，回滚开关状态\n        this.$nextTick(() => { this.isOnline = !newStatus; });\n         uni.showToast({ \n           title: '请求更新状态失败', \n           icon: 'none' \n         });\n      } finally {\n        uni.hideLoading();\n      }\n    },\n\n    goToRegister() {\n      // 检查是否登录\n      const userInfo = uni.getStorageSync('userInfo')\n      if (!userInfo) {\n        uni.showToast({\n          title: '请先登录',\n          icon: 'none'\n        })\n        setTimeout(() => {\n          uni.navigateTo({\n            url: '/pages/mine/'\n          })\n        }, 1500)\n        return\n      }\n      \n      // 已登录，跳转到志愿者注册页面\n      uni.navigateTo({\n        url: '/pages/index/volunteer-register'\n      })\n    },\n    \n    // 跳转到视频协助页面\n    goToVideoAssist() {\n      uni.navigateTo({\n        url: '/pages/spxz/spxz' // 假设 spxz.vue 页面路径为 /pages/spxz/spxz\n      });\n    }\n  }\n}\n</script>\n\n<style scoped>\n/* ========== 核心视觉样式 ========== */\n/* 容器样式 */\n.volunteer-container {\n  padding: 30rpx;\n  background: #f5f5f5;\n  min-height: 100vh;\n}\n\n/* 注册部分样式 */\n.register-section {\n  background: #fff;\n  border-radius: 16rpx;\n  padding: 40rpx 30rpx;\n  text-align: center;\n  margin-top: 100rpx;\n}\n\n.register-header {\n  margin-bottom: 40rpx;\n}\n\n.register-title {\n  font-size: 40rpx;\n  font-weight: bold;\n  color: #333;\n  display: block;\n  margin-bottom: 20rpx;\n}\n\n.register-subtitle {\n  font-size: 28rpx;\n  color: #666;\n}\n\n.register-btn {\n  background: #1AAD19;\n  color: white;\n  border-radius: 40rpx;\n  font-size: 32rpx;\n  padding: 20rpx 0;\n  width: 100%;\n  text-align: center;\n  box-shadow: 0 4rpx 12rpx rgba(26, 173, 25, 0.2);\n}\n\n/* 状态栏 */\n.status-bar {\n  background: #fff;\n  padding: 30rpx;\n  border-radius: 16rpx;\n  display: flex;\n  align-items: center;\n  margin-bottom: 30rpx;\n  box-shadow: 0 4rpx 12rpx rgba(0,0,0,0.08);\n}\n\n.status-title {\n  font-size: 36rpx;\n  color: #333;\n  margin-right: 30rpx;\n}\n\n/* 替换 .mock-switch 的样式 */\n.status-switch {\n  /* uni-switch 默认样式已经很好，这里可以只调整边距或尺寸 */\n  transform: scale(0.9); /* 微调大小 */\n  margin-right: 10rpx; /* 调整与文本的间距 */\n}\n\n.status-text {\n  font-size: 28rpx;\n  color: #666;\n}\n\n/* 服务标签 */\n.tag-container {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 20rpx;\n  margin-top: 20rpx;\n}\n\n.mock-tag {\n  padding: 16rpx 32rpx;\n  border: 2rpx solid #eee;\n  border-radius: 40rpx;\n  font-size: 28rpx;\n}\n\n.mock-tag.active {\n  background: #e6f7ff;\n  border-color: #1890ff;\n  color: #1890ff;\n}\n\n/* 任务列表 */\n.mock-task {\n  padding: 30rpx;\n  background: #fff;\n  border-radius: 16rpx;\n  margin-bottom: 20rpx;\n}\n\n.mock-task.urgent {\n  border-left: 8rpx solid #ff4d4f;\n}\n\n.mock-btn {\n  background: #1AAD19;\n  color: white;\n  border-radius: 40rpx;\n  padding: 16rpx 40rpx;\n  text-align: center;\n}\n</style>","import MiniProgramPage from 'D:/JAVAEE/myflies/uniapp-app/uniapp/pages/index/elective.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni"],"mappings":"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"}