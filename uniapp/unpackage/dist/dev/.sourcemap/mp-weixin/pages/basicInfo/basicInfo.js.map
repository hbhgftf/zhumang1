{"version":3,"file":"basicInfo.js","sources":["pages/basicInfo/basicInfo.vue","E:/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvYmFzaWNJbmZvL2Jhc2ljSW5mby52dWU"],"sourcesContent":["<template>\n  <view class=\"container\">\n    <!-- 顶部背景 -->\n    <view class=\"top-bg\"></view>\n    \n    <!-- 基本信息表单 -->\n    <view class=\"form-container\">\n      <view class=\"form-group\">\n        <text class=\"label\">昵称</text>\n        <input type=\"nickname\" class=\"input\" v-model=\"userInfo.nickname\" placeholder=\"请输入昵称\" />\n      </view>\n      \n      <view class=\"form-group\">\n        <text class=\"label\">姓名</text>\n        <input type=\"text\" class=\"input\" v-model=\"userInfo.username\" placeholder=\"请输入用户名\" />\n      </view>\n      \n      <view class=\"form-group\">\n        <text class=\"label\">手机号</text>\n        <input type=\"number\" class=\"input\" v-model=\"userInfo.phone\" placeholder=\"请输入手机号\" />\n      </view>\n      \n      <view class=\"form-group\">\n        <text class=\"label\">常用地址</text>\n        <input type=\"text\" class=\"input\" v-model=\"userInfo.usualAddress\" placeholder=\"请输入常用地址\" />\n      </view>\n      \n      \n      <!-- 志愿者专属信息 -->\n      <block v-if=\"isVolunteer\">\n        <view class=\"form-group\">\n          <text class=\"label\">语音设置</text>\n          <input type=\"text\" class=\"input\" v-model=\"userInfo.voiceSettings\" placeholder=\"请输入语音设置\" />\n        </view>\n        \n        <view class=\"form-group\">\n          <text class=\"label\">服务时长</text>\n          <input type=\"number\" class=\"input\" v-model=\"userInfo.serviceHours\" placeholder=\"请输入服务时长\" />\n        </view>\n        \n        <view class=\"form-group\">\n          <text class=\"label\">服务评分</text>\n          <input type=\"number\" class=\"input\" v-model=\"userInfo.serviceRating\" placeholder=\"请输入服务评分\" />\n        </view>\n        \n        <view class=\"form-group\">\n          <text class=\"label\">所属组织</text>\n          <input type=\"text\" class=\"input\" v-model=\"userInfo.organization\" placeholder=\"请输入所属组织\" />\n        </view>\n        \n        <view class=\"form-group\">\n          <text class=\"label\">认证时间</text>\n          <input type=\"text\" class=\"input\" v-model=\"userInfo.certificationTime\" placeholder=\"请输入认证时间\" />\n        </view>\n      </block>\n     \n    </view>\n    \n    <!-- 保存按钮 -->\n    <view class=\"button-container\">\n      <button class=\"save-btn\" @tap=\"handleSave\">保存修改</button>\n    </view>\n  </view>\n</template>\n\n<script>\nexport default {\n  data() {\n    return {\n      isVolunteer: false, // 新增：是否为志愿者\n      userInfo: {\n        id: '',\n        nickname: '',\n        name: '',\n        phone: '',\n        usualAddress: '',\n        voiceSettings: '',\n        serviceHours: '',\n        serviceRating: '',\n        organization: '',\n        certificationTime: '',\n        username: ''\n      }\n    };\n  },\n  \n  onLoad() {\n    this.checkVolunteerStatus(); // 检查志愿者状态\n    this.loadUserInfo();\n  },\n  \n  onShow() {\n    // 每次页面显示时重新检查状态\n    this.checkVolunteerStatus()\n  },\n  \n  methods: {\n    // 新增：检查志愿者状态\n    checkVolunteerStatus() {\n      const userInfo = uni.getStorageSync('userInfo');\n      if (userInfo && userInfo.role === '志愿者') {\n        this.isVolunteer = true;\n      } else {\n        this.isVolunteer = false;\n      }\n    },\n    \n    // 加载用户信息\n    async loadUserInfo() {\n      try {\n        const userInfo = uni.getStorageSync('userInfo');\n        console.log('存储的用户信息:', userInfo); // 添加日志\n        \n        if (!userInfo) {\n          throw new Error('未找到用户信息，请先登录');\n        }\n        \n        if (!userInfo.id) {\n          console.error('用户信息中缺少ID:', userInfo);\n          throw new Error('用户信息不完整，请重新登录');\n        }\n        \n        const token = uni.getStorageSync('token');\n        console.log('存储的token:', token); // 添加日志\n        \n        if (!token) {\n          throw new Error('未找到登录凭证，请重新登录');\n        }\n        \n        const res = await uni.request({\n          url: `${this.$config.baseUrl}/user/getUserInfo?id=${userInfo.id}`,\n          method: 'GET',\n          header: {\n            'Authorization': `Bearer ${token}`\n          }\n        });\n        \n        console.log('获取用户信息响应:', res); // 添加日志\n        \n        if (res.data.code === 200) {\n          // 只更新存在的字段，避免覆盖可能未返回的role等\n          this.userInfo = { ...this.userInfo, ...res.data.data.userInfo };\n          console.log('更新后的用户信息:', this.userInfo); // 添加日志\n        } else {\n          throw new Error(res.data.message || '获取用户信息失败');\n        }\n      } catch (error) {\n        console.error('加载用户信息失败:', error);\n        // 如果是未登录错误，跳转到登录页面\n        if (error.message.includes('未找到用户信息') || error.message.includes('未找到登录凭证')) {\n          uni.showModal({\n            title: '提示',\n            content: '请先登录',\n            showCancel: false,\n            success: () => {\n              uni.switchTab({\n                url: '/pages/index/mine'\n              });\n            }\n          });\n        } else {\n          uni.showToast({ \n            title: error.message || '加载失败，请重试', \n            icon: 'none' \n          });\n        }\n      }\n    },\n    \n    // 保存修改\n    async handleSave() {\n      try {\n        const userInfo = uni.getStorageSync('userInfo');\n        if (!userInfo || !userInfo.id) {\n          throw new Error('用户未登录');\n        }\n        \n        const token = uni.getStorageSync('token');\n        if (!token) {\n          throw new Error('未找到登录凭证');\n        }\n        \n        // 确保id存在\n        this.userInfo.id = userInfo.id;\n        \n        const res = await uni.request({\n          url: `${this.$config.baseUrl}/user/updateUserInfo`,\n          method: 'POST',\n          data: this.userInfo,\n          header: { \n            'Content-Type': 'application/json',\n            'Authorization': `Bearer ${token}`\n          }\n        });\n        \n        if (res.data.code === 200) {\n          uni.showToast({ \n            title: '保存成功', \n            icon: 'success' \n          });\n          // 更新本地存储中可能改变的字段\n          uni.setStorageSync('userInfo', {\n            ...userInfo,\n            ...this.userInfo\n          });\n        } else {\n          throw new Error(res.data.message || '保存失败');\n        }\n      } catch (error) {\n        console.error('保存失败:', error);\n        uni.showToast({ \n          title: error.message || '保存失败，请重试', \n          icon: 'none' \n        });\n      }\n    }\n  }\n};\n</script>\n\n<style>\n.container {\n  min-height: 100vh;\n  background-color: #f8f9fa;\n  position: relative;\n}\n\n.top-bg {\n  height: 240rpx;\n  background: linear-gradient(135deg, #1a237e 0%, #0d47a1 100%);\n  position: relative;\n  overflow: hidden;\n}\n\n.top-bg::after {\n  content: '';\n  position: absolute;\n  bottom: 0;\n  left: 0;\n  right: 0;\n  height: 120rpx;\n  background: linear-gradient(to bottom, transparent, rgba(255, 255, 255, 0.1));\n}\n\n.form-container {\n  margin: -120rpx 30rpx 0;\n  padding: 40rpx 30rpx;\n  background-color: #fff;\n  border-radius: 24rpx;\n  box-shadow: 0 8rpx 32rpx rgba(0, 0, 0, 0.08);\n  position: relative;\n  z-index: 1;\n}\n\n.form-group {\n  margin-bottom: 36rpx;\n  position: relative;\n}\n\n.label {\n  display: block;\n  font-size: 28rpx;\n  color: #333;\n  margin-bottom: 12rpx;\n  font-weight: 500;\n  transition: all 0.3s ease;\n}\n\n.input {\n  width: 100%;\n  height: 88rpx;\n  padding: 0 24rpx;\n  background: #f8f9fa;\n  border: 2rpx solid #e0e0e0;\n  border-radius: 12rpx;\n  font-size: 30rpx;\n  color: #333;\n  transition: all 0.3s ease;\n}\n\n.input:focus {\n  border-color: #1a237e;\n  background: #fff;\n  box-shadow: 0 0 0 4rpx rgba(26, 35, 126, 0.1);\n}\n\n.input::placeholder {\n  color: #999;\n}\n\n/* 志愿者专属信息样式 */\n.form-group.volunteer {\n  background: #f5f7ff;\n  padding: 24rpx;\n  border-radius: 12rpx;\n  margin-top: 40rpx;\n}\n\n.form-group.volunteer .label {\n  color: #1a237e;\n}\n\n.form-group.volunteer .input {\n  background: #fff;\n}\n\n/* 保存按钮容器 */\n.button-container {\n  padding: 40rpx 30rpx;\n  position: fixed;\n  bottom: 0;\n  left: 0;\n  right: 0;\n  background: #fff;\n  box-shadow: 0 -4rpx 16rpx rgba(0, 0, 0, 0.05);\n  z-index: 2;\n}\n\n.save-btn {\n  width: 100%;\n  height: 88rpx;\n  background: linear-gradient(135deg, #1a237e 0%, #0d47a1 100%);\n  color: #fff;\n  font-size: 32rpx;\n  font-weight: 500;\n  border-radius: 44rpx;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  transition: all 0.3s ease;\n  border: none;\n}\n\n.save-btn:active {\n  transform: scale(0.98);\n  opacity: 0.9;\n}\n\n/* 动画效果 */\n@keyframes slideUp {\n  from {\n    opacity: 0;\n    transform: translateY(20rpx);\n  }\n  to {\n    opacity: 1;\n    transform: translateY(0);\n  }\n}\n\n.form-group {\n  animation: slideUp 0.3s ease forwards;\n  opacity: 0;\n}\n\n.form-group:nth-child(1) { animation-delay: 0.1s; }\n.form-group:nth-child(2) { animation-delay: 0.2s; }\n.form-group:nth-child(3) { animation-delay: 0.3s; }\n.form-group:nth-child(4) { animation-delay: 0.4s; }\n.form-group:nth-child(5) { animation-delay: 0.5s; }\n.form-group:nth-child(6) { animation-delay: 0.6s; }\n\n/* 暗色模式适配 */\n@media (prefers-color-scheme: dark) {\n  .container {\n    background-color: #121212;\n  }\n  \n  .form-container {\n    background-color: #1e1e1e;\n  }\n  \n  .label {\n    color: #e0e0e0;\n  }\n  \n  .input {\n    background: #2d2d2d;\n    border-color: #404040;\n    color: #e0e0e0;\n  }\n  \n  .input:focus {\n    border-color: #7986cb;\n    background: #2d2d2d;\n    box-shadow: 0 0 0 4rpx rgba(121, 134, 203, 0.2);\n  }\n  \n  .input::placeholder {\n    color: #666;\n  }\n  \n  .form-group.volunteer {\n    background: #1a1a1a;\n  }\n  \n  .form-group.volunteer .label {\n    color: #7986cb;\n  }\n  \n  .button-container {\n    background: #1e1e1e;\n  }\n}\n\n/* 无障碍增强 */\n.input:focus {\n  outline: none;\n}\n\n.save-btn:focus {\n  outline: 4rpx solid #7986cb;\n  outline-offset: 2rpx;\n}\n\n/* 错误状态 */\n.input.error {\n  border-color: #f44336;\n  background: #fff5f5;\n}\n\n.error-message {\n  font-size: 24rpx;\n  color: #f44336;\n  margin-top: 8rpx;\n}\n</style> ","import MiniProgramPage from 'D:/JAVAEE/myflies/uniapp-app/uniapp/pages/basicInfo/basicInfo.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni"],"mappings":"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"}