{"version":3,"file":"policy.js","sources":["pages/policy/policy.vue","E:/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvcG9saWN5L3BvbGljeS52dWU"],"sourcesContent":["<template>\n  <view class=\"container\">\n    <!-- 地区选择器 -->\n    <view class=\"header\">\n      <picker \n        mode=\"selector\" \n        :range=\"regions\" \n        @change=\"onRegionChange\" \n        class=\"region-picker\"\n      >\n        <view class=\"picker-content\">\n          <text class=\"selected-region\">{{ currentRegion }}</text>\n          <text class=\"picker-arrow\">▼</text>\n        </view>\n      </picker>\n    </view>\n\n    <!-- 瀑布流内容区 -->\n    <view class=\"waterfall-container\">\n      <view class=\"waterfall-column left-column\">\n        <view \n          v-for=\"item in leftColumn\" \n          :key=\"item.id\"\n          class=\"policy-card\"\n          @click=\"navigateToDetail(item.id)\"\n          :style=\"{ opacity: item.loaded ? 1 : 0 }\"\n        >\n          <image \n            v-if=\"item.cover\" \n            :src=\"item.cover\" \n            mode=\"widthFix\"\n            class=\"card-cover\"\n            loading=\"lazy\"\n            @load=\"onImageLoad(item.id)\"\n          />\n          <view class=\"card-tag\" v-if=\"item.tags && item.tags.length\">\n            {{ item.tags[0] }}\n          </view>\n          <view class=\"card-content\">\n            <text class=\"card-title\">{{ item.title }}</text>\n            <text class=\"card-summary\">{{ item.summary }}</text>\n            <view class=\"card-footer\">\n              <text class=\"publish-date\">{{ formatDate(item.publishDate) }}</text>\n              <text class=\"views\">{{ formatViews(item.views) }}阅读</text>\n            </view>\n          </view>\n        </view>\n      </view>\n\n      <view class=\"waterfall-column right-column\">\n        <view \n          v-for=\"item in rightColumn\" \n          :key=\"item.id\"\n          class=\"policy-card\"\n          @click=\"navigateToDetail(item.id)\"\n          :style=\"{ opacity: item.loaded ? 1 : 0 }\"\n        >\n          <image \n            v-if=\"item.cover\" \n            :src=\"item.cover\" \n            mode=\"widthFix\"\n            class=\"card-cover\"\n            loading=\"lazy\"\n            @load=\"onImageLoad(item.id)\"\n          />\n          <view class=\"card-tag\" v-if=\"item.tags && item.tags.length\">\n            {{ item.tags[0] }}\n          </view>\n          <view class=\"card-content\">\n            <text class=\"card-title\">{{ item.title }}</text>\n            <text class=\"card-summary\">{{ item.summary }}</text>\n            <view class=\"card-footer\">\n              <text class=\"publish-date\">{{ formatDate(item.publishDate) }}</text>\n              <text class=\"views\">{{ formatViews(item.views) }}阅读</text>\n            </view>\n          </view>\n        </view>\n      </view>\n    </view>\n\n    <!-- 加载状态 -->\n    <view class=\"loading-container\" v-if=\"loading || !hasMore\">\n      <view v-if=\"loading\" class=\"loading\">\n        <image src=\"/static/loading.gif\" mode=\"widthFix\" class=\"loading-icon\" />\n        <text>加载中...</text>\n      </view>\n      <text v-else-if=\"!hasMore\" class=\"no-more\">没有更多数据了</text>\n    </view>\n\n    <!-- 错误状态 -->\n    <view v-if=\"error\" class=\"error-container\">\n      <image src=\"/static/error.png\" mode=\"widthFix\" class=\"error-icon\" />\n      <text class=\"error-text\">加载失败，请检查网络</text>\n      <button class=\"retry-btn\" @click=\"loadPolicies\">重试</button>\n    </view>\n  </view>\n</template>\n\n<script>\nexport default {\n  data() {\n    return {\n      regions: ['全国', '北京', '上海', '广州', '深圳'],\n      currentRegion: '全国',\n      leftColumn: [],\n      rightColumn: [],\n      page: 1,\n      pageSize: 10,\n      loading: false,\n      hasMore: true,\n      error: false,\n      mockPolicies: Array.from({ length: 50 }, (_, i) => ({\n        id: i + 1,\n        title: `2024年助残政策${i + 1}`,\n        summary: `本政策针对视力障碍群体提供${['就业', '教育', '出行'][Math.floor(Math.random() * 3)]}补贴`,\n        publishDate: Date.now() - (i * 24 * 60 * 60 * 1000),\n        views: Math.floor(Math.random() * 20000) + 1000,\n        cover: `https://picsum.photos/300/${Math.floor(Math.random() * 200 + 150)}?random=${i}`,\n        tags: ['国家政策', '助残补贴', '无障碍建设'][Math.floor(Math.random() * 3)]\n      }))\n    }\n  },\n\n  onLoad() {\n    this.loadPolicies();\n  },\n\n  onReachBottom() {\n    if (!this.loading && this.hasMore) {\n      this.loadPolicies();\n    }\n  },\n\n  methods: {\n    async loadPolicies() {\n      if (this.loading || !this.hasMore) return;\n\n      this.loading = true;\n      this.error = false;\n\n      try {\n        const start = (this.page - 1) * this.pageSize;\n        const end = this.page * this.pageSize;\n        const newPolicies = this.mockPolicies.slice(start, end);\n\n        if (newPolicies.length === 0) {\n          this.hasMore = false;\n          return;\n        }\n\n        newPolicies.forEach((policy, index) => {\n          if (index % 2 === 0) {\n            this.leftColumn.push({ ...policy, loaded: false });\n          } else {\n            this.rightColumn.push({ ...policy, loaded: false });\n          }\n        });\n\n        await new Promise(resolve => setTimeout(resolve, 1000)); // 模拟加载延迟\n\n        this.hasMore = end < this.mockPolicies.length;\n        this.page++;\n      } catch (error) {\n        this.error = true;\n        console.error('加载数据失败:', error);\n      } finally {\n        this.loading = false;\n      }\n    },\n\n    onRegionChange(e) {\n      this.currentRegion = this.regions[e.detail.value];\n      this.resetData();\n      this.loadPolicies();\n    },\n\n    resetData() {\n      this.leftColumn = [];\n      this.rightColumn = [];\n      this.page = 1;\n      this.hasMore = true;\n      this.error = false;\n    },\n\n    onImageLoad(id) {\n      const updateColumn = (column) => {\n        const index = column.findIndex(item => item.id === id);\n        if (index !== -1) column[index].loaded = true;\n      };\n      updateColumn(this.leftColumn);\n      updateColumn(this.rightColumn);\n    },\n\n    navigateToDetail(id) {\n      uni.navigateTo({ url: `/pages/policy/detail?id=${id}` });\n    },\n\n    formatDate(timestamp) {\n      const date = new Date(timestamp);\n      return date.toISOString().split('T')[0];\n    },\n\n    formatViews(views) {\n      return views >= 10000 ? `${(views / 10000).toFixed(1)}万` : views;\n    }\n  }\n};\n</script>\n\n<style scoped>\n.container {\n  padding: 20rpx;\n  background: #f5f5f5;\n  min-height: 100vh;\n}\n\n.header {\n  position: sticky;\n  top: 0;\n  z-index: 100;\n  background: #ffffff;\n  padding: 20rpx;\n  margin-bottom: 20rpx;\n  border-radius: 16rpx;\n  box-shadow: 0 2rpx 8rpx rgba(0, 0, 0, 0.08);\n}\n\n.region-picker {\n  width: 100%;\n  max-width: 300rpx;\n}\n\n.picker-content {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 15rpx 20rpx;\n  border-radius: 12rpx;\n  background: #f8f8f8;\n}\n\n.selected-region {\n  font-size: 32rpx;\n  font-weight: 500;\n  color: #333333;\n}\n\n.picker-arrow {\n  font-size: 28rpx;\n  color: #999999;\n}\n\n.waterfall-container {\n  display: flex;\n  gap: 20rpx;\n}\n\n.waterfall-column {\n  width: 48%;\n}\n\n.policy-card {\n  background: #ffffff;\n  border-radius: 16rpx;\n  margin-bottom: 20rpx;\n  box-shadow: 0 4rpx 16rpx rgba(0, 0, 0, 0.05);\n  overflow: hidden;\n  transition: all 0.3s ease;\n  opacity: 0;\n  transform: translateY(20rpx);\n  will-change: opacity, transform;\n}\n\n.policy-card.visible {\n  opacity: 1;\n  transform: translateY(0);\n}\n\n.card-cover {\n  width: 100%;\n  height: auto;\n  aspect-ratio: 3/2;\n  object-fit: cover;\n}\n\n.card-tag {\n  position: absolute;\n  top: 16rpx;\n  right: 16rpx;\n  padding: 4rpx 12rpx;\n  background: rgba(255, 215, 0, 0.1);\n  color: #FFD700;\n  font-size: 24rpx;\n  border-radius: 20rpx;\n}\n\n.card-content {\n  padding: 20rpx;\n}\n\n.card-title {\n  font-size: 34rpx;\n  font-weight: 600;\n  color: #1A1A1A;\n  margin-bottom: 12rpx;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n}\n\n.card-summary {\n  font-size: 28rpx;\n  color: #666666;\n  line-height: 1.6;\n  display: -webkit-box;\n  -webkit-box-orient: vertical;\n  -webkit-line-clamp: 2;\n  overflow: hidden;\n}\n\n.card-footer {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-top: 16rpx;\n  font-size: 24rpx;\n  color: #999999;\n}\n\n.loading-container {\n  padding: 40rpx 0;\n  text-align: center;\n}\n\n.loading {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 10rpx;\n}\n\n.loading-icon {\n  width: 40rpx;\n  height: 40rpx;\n  animation: spin 1s linear infinite;\n}\n\n.no-more {\n  font-size: 28rpx;\n  color: #999999;\n}\n\n.error-container {\n  padding: 80rpx 20rpx;\n  text-align: center;\n}\n\n.error-icon {\n  width: 200rpx;\n  height: 200rpx;\n  margin-bottom: 30rpx;\n}\n\n.error-text {\n  font-size: 32rpx;\n  color: #666666;\n  margin-bottom: 20rpx;\n}\n\n.retry-btn {\n  padding: 18rpx 60rpx;\n  background: #FF5252;\n  color: #ffffff;\n  border-radius: 28rpx;\n  font-size: 30rpx;\n  font-weight: 500;\n  transition: opacity 0.3s;\n}\n\n.retry-btn:active {\n  opacity: 0.8;\n}\n\n@keyframes spin {\n  from { transform: rotate(0deg); }\n  to { transform: rotate(360deg); }\n}\n</style>","import MiniProgramPage from 'D:/JAVAEE/myflies/uniapp-app/uniapp/pages/policy/policy.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni"],"mappings":"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"}